# Claude Code 本地代理系统安全审核 Prompt

## 项目背景

我开发了一个本地代理系统，用于在 Anthropic 不支持的地区访问 Claude Code API。该系统需要满足以下核心需求：

1. **绕过地理限制**：通过高质量住宅代理 IP（评分90+）访问 Claude API
2. **本地运行**：所有代码在本地执行，通过 `ANTHROPIC_BASE_URL=http://localhost:7070` 接入
3. **高度隐蔽**：避免被检测为自动化或代理访问
4. **长期稳定**：支持 24 小时 Sticky Session，保持稳定连接

## 审核要求

请以网络安全专家的角度，帮我审核这个项目的以下方面：

### 1. 代理特征检测风险
- 分析当前实现是否存在容易被检测的代理特征
- 检查 HTTP 请求头、TLS 指纹、DNS 查询等方面
- 评估健康检查机制是否会暴露自动化行为
- 审查 IP 纯净度检查的实现是否合理

### 2. 请求模式分析
- 评估请求间隔和频率是否自然
- 检查是否有固定的行为模式
- 分析时区处理和地理位置匹配是否合理
- 审查人类行为模拟的有效性

### 3. 技术实现评估
- Node.js 代理实现是否存在技术缺陷
- TLS 指纹伪装是否充分
- 请求头生成逻辑是否真实
- 会话管理机制是否合理

### 4. 安全性审查
- 敏感信息（代理凭据）的存储是否安全
- 日志记录是否会泄露敏感信息
- 是否存在 DNS 泄露风险
- 本地服务是否有安全漏洞

### 5. 改进建议
- 哪些地方最容易被检测到
- 优先级最高的改进点是什么
- 是否有更好的技术方案
- 如何进一步提高隐蔽性

## 关键代码文件

请重点审查以下文件：
- `/src/index.js` - 主服务入口和代理中间件配置
- `/src/managers/ProxyManager.js` - 代理连接和会话管理
- `/src/utils/EnhancedSecurity.js` - 安全增强和行为模拟
- `/src/utils/IPReputationChecker.js` - IP 质量检查
- `/config/proxy.json` - 代理配置文件

## 具体关注点

1. **健康检查频率**：当前为 5-10 分钟随机间隔，是否还需要优化？
2. **User-Agent 轮换**：目前有 6 个不同的 UA，是否足够？
3. **请求头一致性**：各种请求头之间是否存在矛盾？
4. **代理链路**：是否需要增加 WARP 或其他中间层？
5. **流量特征**：纯 API 请求是否太单一，需要混入其他流量？

## 期望输出

请提供：
1. **风险等级评估**（高/中/低）
2. **具体问题列表**（按严重程度排序）
3. **改进方案**（包含具体实现建议）
4. **最佳实践建议**（基于您的经验）

## 补充信息

- 代理 IP 质量：90+ 分的美国/欧洲住宅 IP
- 使用场景：个人开发使用，非高频请求
- 技术栈：Node.js + Express + http-proxy-middleware
- 已实现：TLS 指纹、智能延迟、行为模拟、IP 缓存

请帮我找出所有可能导致被检测或封禁的风险点，并提供具体的改进建议。谢谢！